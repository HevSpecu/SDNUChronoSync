# 课表页面功能更新说明

## 更新概述

本次更新重构了课表页面的操作按钮，将多个分散的功能合并到一个"更多"按钮中，并新增了从ICS文件导入课表的功能。

## 主要变化

### 1. UI重构
- **移除了课表下拉菜单中的**：导出、编辑按钮
- **移除了独立的三个按钮**：调休、导入、添加
- **新增"更多"按钮**，包含五个功能选项

### 2. "更多"按钮功能菜单

#### 添加日程
- 图标：PlusCircleIcon（加号圆圈）
- 功能：打开添加日程弹窗（保持原有功能）

#### 导入课表
- 图标：CloudArrowDownIcon（云下载）
- 功能：打开导入选项弹窗
  - 选项1：从ICS文件导入（新功能）
  - 选项2：从教务系统导入（原有功能）

#### 导出课表
- 图标：ArrowDownTrayIcon（下载）
- 功能：打开导出选项弹窗
  - 选项1：导出到图片(PNG)
  - 选项2：导出到ICS

#### 放假调休
- 图标：CalendarDaysIcon（日历）
- 功能：打开调休设置弹窗（保持原有功能）

#### 课表设置
- 图标：Cog6ToothIcon（设置齿轮）
- 功能：打开课表编辑弹窗（原有的编辑课表功能）

### 3. 新功能：从ICS文件导入

#### 前端实现
- 创建了 `ImportOptionsModal.vue` 组件
- 用户选择"从ICS文件导入"后，会打开文件选择对话框
- 只接受 `.ics` 格式的文件
- 导入成功后显示导入的事件数量

#### 后端实现
- 新增API端点：`POST /api/schedules/import-ics`
- 参数：
  - `file`: ICS文件
  - `schedule_id`: 目标课表ID
- 功能：
  - 解析ICS文件中的事件
  - 根据课表开始日期计算每个事件的周数和星期几
  - 将事件导入到指定课表
  - 返回导入成功的数量和错误信息

### 4. 响应式设计

#### 移动端 (< 640px)
- "更多"按钮显示图标
- 在 >= 300px 时显示"更多"文字

#### 桌面端 (>= 640px)
- "更多"按钮显示图标
- 在特定断点显示"更多"文字
  - `hidden min-[640px]:inline min-[1200px]:hidden min-[1300px]:inline`

## 使用流程

### 导入ICS文件
1. 点击"更多"按钮
2. 选择"导入课表"
3. 在弹窗中选择"从ICS文件导入"
4. 选择一个.ics文件
5. 系统会自动解析并导入事件到当前活跃课表

### 导出课表
1. 点击"更多"按钮
2. 选择"导出课表"
3. 在弹窗中选择导出格式：
   - PNG图片：生成课表图片并下载
   - ICS文件：导出为日历文件

## 技术细节

### 新增组件
- `ImportOptionsModal.vue`：导入选项弹窗
- `ExportOptionsModal.vue`：导出选项弹窗

### 新增图标
- `EllipsisHorizontalIcon`：更多按钮（三个点）
- `PlusCircleIcon`：添加日程
- `Cog6ToothIcon`：课表设置
- `DocumentArrowUpIcon`：ICS文件导入
- `AcademicCapIcon`：教务系统导入
- `PhotoIcon`：导出图片
- `CalendarIcon`：导出ICS

### API端点
- `POST /api/schedules/import-ics`
  - 接受FormData格式
  - 文件字段名：`file`
  - 课表ID字段名：`schedule_id`

## 注意事项

1. ICS导入时，事件的周数是根据课表开始日期自动计算的
2. 如果ICS文件中的事件时间早于课表开始时间，该事件会被跳过
3. 所有图标使用Heroicons库（而非FontAwesome）
4. 课表设置菜单项只在有活跃课表时显示
5. 放假调休菜单项只在有活跃课表时显示

## 测试建议

1. 测试响应式设计：在不同屏幕尺寸下查看按钮显示
2. 测试ICS导入：使用标准的ICS文件进行导入
3. 测试导出功能：确保PNG和ICS导出正常工作
4. 测试所有菜单项的功能：确保原有功能正常运行

